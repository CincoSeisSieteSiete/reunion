{% extends "base.html" %}

{% block title %}{{ grupo.nombre }}{% endblock %}

{% block header %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/grupo.css') }}">
{% endblock %}

{% block content %}
<div class="grupo-header">
    <h1 class="grupo-title">{{ grupo.nombre }}</h1>
    <p class="grupo-description">{{ grupo.descripcion or 'Sin descripci√≥n' }}</p>
    <p class="grupo-admin">Administrador: {{ grupo.admin_nombre }}</p>

    <!-- Bot√≥n de salir -->
    
    
    <div class="grupo-actions">
        {% if es_admin %}
            <a href="{{ url_for('tomar_asistencia', grupo_id=grupo.id) }}" class="btn">Tomar Asistencia</a>
            <a href="{{ url_for('gestionar_puntos', grupo_id=grupo.id) }}" class="btn">Gestionar Puntos</a>

        {% endif %}
         <a href="{{ url_for('cumpleanos', id_grupo=grupo.id) }}" class="btn">Ver Cumplea√±os</a>

    </div>
    



    
    <div class="codigo-container">
        <div class="codigo-label">C√≥digo de Invitaci√≥n</div>
        <span class="codigo-value">{{ grupo.codigo_invitacion }}</span>
        <button class="btn btn-copy" onclick="copiarCodigo('{{ grupo.codigo_invitacion }}')">Copiar</button>
    </div>
</div>

<div class="leaderboard-card">
    <div class="leaderboard-header">
        <h2 class="leaderboard-title">Tabla de Clasificaci√≥n</h2>
    </div>
    <table class="leaderboard-table">
        <thead>
            <tr>
                <th>Posici√≥n</th>
                <th>Nombre</th>
                <th>Puntos</th>
                <th>Racha</th>
                <th>Medallas</th>
                <th>Asistencias</th>
            </tr>
        </thead>
        <tbody>
            {% for usuario in ranking %}
            <tr class="{% if loop.index == 1 %}ranking-gold{% elif loop.index == 2 %}ranking-silver{% elif loop.index == 3 %}ranking-bronze{% endif %}">
                <td data-label="Posici√≥n">
                    {% if loop.index <= 3 %}
                        <span class="position-icon">‚òÖ</span>
                    {% else %}
                        {{ loop.index }}
                    {% endif %}
                </td>
                <td data-label="Nombre"><strong>{{ usuario.nombre }}</strong></td>
                <td data-label="Puntos"><span class="badge">{{ usuario.puntos }} PTS</span></td>
                <td data-label="Racha"><span class="badge">{{ usuario.racha }} üî•</span></td>
                <td data-label="Medallas"><span class="badge">{{ usuario.total_medallas }} üèÜ</span></td>
                <td data-label="Asistencias">{{ usuario.asistencias_grupo }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="exit-container">
  <form method="POST" action="/salir_reunion/{{ grupo.id }}" onsubmit="return confirm('¬øEst√°s seguro de que deseas salir de la reuni√≥n?');">
      <button type="submit" class="btn-exit">Salir de la Reuni√≥n</button>
  </form>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<script>
function copiarCodigo(codigo) {
    navigator.clipboard.writeText(codigo).then(() => {
        alert('C√≥digo copiado al portapapeles!');
    });
}

// Animate header
anime({
    targets: '.grupo-header',
    opacity: [0, 1],
    translateY: [-50, 0],
    duration: 1000,
    easing: 'easeOutExpo'
});

// Animate table rows
anime({
    targets: '.leaderboard-table tbody tr',
    opacity: [0, 1],
    translateX: [-30, 0],
    delay: anime.stagger(100, {start: 500}),
    duration: 800,
    easing: 'easeOutExpo'
});
</script>
{% endblock %}
