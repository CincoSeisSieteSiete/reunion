{% extends "base.html" %}

{% block title %}{{ grupo.nombre }}{% endblock %}

{% block header %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/grupo.css') }}">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<main class="ui-container">

    <header class="ui-header">
        <div class="header-meta">
            <span class="admin-badge">Admin: {{ grupo.admin_nombre }}</span>
        </div>
        <h1 class="ui-title">{{ grupo.nombre }}</h1>
        <p class="ui-desc">{{ grupo.descripcion or 'Sin descripci√≥n disponible.' }}</p>
        
        <div class="code-component" onclick="copiarCodigo(this, '{{ grupo.codigo_invitacion }}')">
            <div class="code-label">C√≥digo de invitaci√≥n</div>
            <div class="code-value">
                {{ grupo.codigo_invitacion }}
                <span class="copy-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                </span>
            </div>
            <div class="toast">¬°Copiado!</div>
        </div>
    </header>

    <div class="ui-actions">
        {% if es_admin %}
        <a href="{{ url_for('tomar_asistencia', grupo_id=grupo.id) }}" class="action-btn primary">
            <span>üìù</span> Tomar Asistencia
        </a>
        <a href="{{ url_for('gestionar_puntos', grupo_id=grupo.id) }}" class="action-btn secondary">
            <span>‚ö°</span> Gestionar Puntos
        </a>
        {% endif %}
        <a href="{{ url_for('cumpleanos', id_grupo=grupo.id) }}" class="action-btn ghost">
            <span>üéÇ</span> Cumplea√±os
        </a>
    </div>

    <hr class="ui-divider">

    <section class="ranking-section">
        <div class="section-header">
            <h2>Tabla de Clasificaci√≥n</h2>
        </div>

        {% if ranking|length > 0 %}
        <div class="podium-layout">
            
            {% if ranking[0] %}
            <div class="rank-card gold">
                <div class="rank-medal">ü•á</div>
                <div class="rank-avatar-lg">{{ ranking[0].nombre[0] | upper }}</div>
                <div class="rank-info">
                    <h3>{{ ranking[0].nombre }}</h3>
                    <div class="rank-score">{{ ranking[0].puntos }} pts</div>
                </div>
                <div class="rank-badge">L√≠der</div>
            </div>
            {% endif %}

            <div class="runners-up-list">
                {% if ranking[1] %}
                <div class="rank-row-item silver">
                    <div class="pos-circle">2</div>
                    <div class="row-avatar">{{ ranking[1].nombre[0] | upper }}</div>
                    <div class="row-name">{{ ranking[1].nombre }}</div>
                    <div class="row-points">{{ ranking[1].puntos }} pts</div>
                </div>
                {% endif %}

                {% if ranking[2] %}
                <div class="rank-row-item bronze">
                    <div class="pos-circle">3</div>
                    <div class="row-avatar">{{ ranking[2].nombre[0] | upper }}</div>
                    <div class="row-name">{{ ranking[2].nombre }}</div>
                    <div class="row-points">{{ ranking[2].puntos }} pts</div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        {% if ranking|length > 3 %}
        <div class="table-container">
            <table class="ui-table">
                <thead>
                    <tr>
                        <th width="50">Pos</th>
                        <th>Estudiante</th>
                        <th class="text-right">Puntos</th>
                    </tr>
                </thead>
                <tbody>
                    {% for usuario in ranking[3:] %}
                    <tr>
                        <td><span class="pos-number">{{ loop.index + 3 }}</span></td>
                        <td>
                            <div class="user-flex">
                                <div class="avatar-xs">{{ usuario.nombre[0] | upper }}</div>
                                <span>{{ usuario.nombre }}</span>
                            </div>
                        </td>
                        <td class="text-right"><strong>{{ usuario.puntos }}</strong></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

    </section>

</main>

<script>
function copiarCodigo(element, codigo) {
    navigator.clipboard.writeText(codigo).then(() => {
        element.classList.add('copied');
        setTimeout(() => element.classList.remove('copied'), 2000);
    });
}
</script>
{% endblock %}