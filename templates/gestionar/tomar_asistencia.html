{% extends "base.html" %}

{% block title %}Tomar Asistencia{% endblock %}

{% block header %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tomar_asistencia/base.css') }}">
{% if session.get('tema', 0) == 0 %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tomar_asistencia/light.css') }}">
{% else %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tomar_asistencia/dark.css') }}">
{% endif %}
{% endblock %}

{% block content %}

<section class="regreso">
  <a href="javascript:history.back()" class="back-link">
    <img src="{{ url_for('static', filename='iconos/arrow-left.svg') }}" alt="Regresar">
  </a>
</section>

<div class="attendance-container">
  <div class="attendance-card">
    <div class="attendance-header">
      <h1>Tomar Asistencia</h1>
      <p>Marca los miembros presentes</p>
    </div>

    <form method="POST">
      <div class="date-group">
        <label for="fecha" class="date-label">Fecha</label>
        <input type="date" class="date-input" id="fecha" name="fecha" value="{{ fecha_hoy }}" required>
      </div>

      <h2 class="section-title">Marcar Asistentes</h2>

      <div class="members-list">
        {% for miembro in miembros %}
        <label class="member-item">
          <div class="member-left">
            <div class="checkbox-custom"></div>
            <input class="checkbox-input" type="checkbox" name="asistentes" value="{{ miembro.id }}" {% if miembro.id in
              asistentes_hoy %}checked{% endif %}>
            <span class="member-name">{{ miembro.nombre }}</span>
          </div>
          <div class="member-stats">
            <span class="stat-badge">{{ miembro.puntos }} PTS</span>
            <span class="stat-badge">{{ miembro.racha }} RACHA</span>
          </div>
        </label>
        {% endfor %}
      </div>

      <button type="submit" class="submit-btn">Guardar Asistencia</button>
    </form>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<script>
  // Animaciones
  anime({
    targets: '.attendance-card',
    opacity: [0, 1],
    translateY: [30, 0],
    duration: 800,
    easing: 'easeOutCubic'
  });

  anime({
    targets: '.member-item',
    opacity: [0, 1],
    translateX: [-20, 0],
    duration: 600,
    delay: anime.stagger(50, { start: 300 }),
    easing: 'easeOutCubic'
  });

  // Manejo correcto de checkbox personalizado
  document.querySelectorAll('.checkbox-input').forEach(checkbox => {
    const item = checkbox.closest('.member-item');

    // Inicializar estado
    if (checkbox.checked) item.classList.add('checked');

    // Escuchar cambios
    checkbox.addEventListener('change', () => {
      if (checkbox.checked) {
        item.classList.add('checked');
      } else {
        item.classList.remove('checked');
      }
    });
  });
</script>
{% endblock %}