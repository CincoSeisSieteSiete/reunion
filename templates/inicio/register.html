{% extends "base.html" %}

{% block title %}Registrarse{% endblock %}

{% block header %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/auth/base.css') }}">
{% if session.get('tema', 0) == 0 %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/light/light.css') }}">
{% else %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dark/dark.css') }}">
{% endif %}
{% endblock %}

{% block content %}

<div class="auth-container registerAu">
  <div class="auth-card">
    <form method="POST">
      <div class="auth-form-group">
        <label for="nombre" class="auth-label">Nombre Completo</label>
        <input type="text" class="auth-input" id="nombre" name="nombre" minlength="8" required>
        <p class="Ejm">Ejemplo: Jairo Sebastian</p>
      </div>

      <div class="auth-form-group">
        <label for="email" class="auth-label">Email</label>
        <input type="email" class="auth-input" id="email" name="email" required>
        <p class="Ejm">Ejemplo: tu-correo@gmail.com</p>
      </div>

      <div class="auth-form-group">
        <label for="password" class="auth-label">Contraseña</label>
        <input type="password" class="auth-input" id="password" name="password" minlength="8" required>
        <p class="Ejm">Mínimo 8 caracteres</p>
      </div>

      <div class="auth-form-group">
        <label for="genero_id" class="auth-label">Género</label>
        <select class="auth-input" id="genero_id" name="genero_id" required>
          <option value="" disabled selected>Selecciona tu género</option>
          <option value="1">Masculino</option>
          <option value="2">Femenino</option>
        </select>
        <p class="Ejm">Selecciona una opción de la lista</p>
      </div>

      <div class="auth-form-group">
        <label for="fecha_nacimiento" class="auth-label">Fecha de Nacimiento</label>
        <input type="date" class="auth-input" id="fecha_nacimiento" name="fecha_nacimiento" required>
        <p class="Ejm">Ejemplo: 01/01/2000</p>
      </div>


      <button type="submit" class="auth-submit">Registrarse</button>
    </form>

    <div style="text-align:center; margin:10px 0;">
      <a href="/login/facebook" class="oauth-btn facebook" title="Registrarse con Facebook">
        <svg class="oauth-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path fill="#ffffff" d="M22 12a10 10 0 1 0-11.5 9.9v-7H8.9v-3h2.6V9.1c0-2.6 1.5-4 3.8-4 1.1 0 2.2.2 2.2.2v2.4h-1.2c-1.2 0-1.6.8-1.6 1.6V12h2.8l-.4 3h-2.4v7A10 10 0 0 0 22 12z"/></svg>
        <span>Registrarse con Facebook</span>
      </a>
    </div>

    <div class="auth-footer">
      <p>¿Ya tienes cuenta? <a href="/login">Inicia sesión aquí</a></p>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<script>
  anime({
    targets: '.auth-card',
    opacity: [0, 1],
    translateY: [30, 0],
    duration: 800,
    easing: 'easeOutCubic'
  });

  anime({
    targets: '.auth-form-group',
    opacity: [0, 1],
    translateX: [-20, 0],
    duration: 600,
    delay: anime.stagger(100, { start: 300 }),
    easing: 'easeOutCubic'
  });
</script>
{% endblock %}

{% block extra_js %}
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '{{ FACEBOOK_CLIENT_ID }}',
      cookie     : true,
      xfbml      : true,
      version    : '{{ FACEBOOK_API_VERSION }}'
    });
    FB.AppEvents && FB.AppEvents.logPageView && FB.AppEvents.logPageView();

    FB.getLoginStatus(function(response) {
      if (typeof statusChangeCallback === 'function') statusChangeCallback(response);
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));

  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
  }

  function statusChangeCallback(response) {
    console.log('FB status', response);
    if (response.status === 'connected') {
      // Send short-lived token to server to create/login user
      fetch('/auth/facebook/js', { method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({access_token: response.authResponse.accessToken}) })
        .then(r=>r.json()).then(data=>{ if(data.ok) window.location='/dashboard'; else alert('Error al autenticar con Facebook'); });
    }
  }
</script>
{% endblock %}